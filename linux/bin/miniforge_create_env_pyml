#!/usr/bin/env bash

export PATH="$HOME/miniforge-pypy3/bin:$PATH"

DOWNLOAD_URL="https://github.com/conda-forge/miniforge/releases/download/24.3.0-0/Miniforge-pypy3-Linux-x86_64.sh"
DOWNLOAD_TMP_FILE="/tmp/$(basename ${DOWNLOAD_URL})"

if ! which mamba &> /dev/null; then

    # https://github.com/conda-forge/miniforge/releases/tag/24.3.0-0 is the latest version supports python 3.10
    echo "Downloading ${DOWNLOAD_URL} ..."

    curl -# -sSLf ${DOWNLOAD_URL} -o ${DOWNLOAD_TMP_FILE} && echo "Installing ..." && bash ${DOWNLOAD_TMP_FILE} -b -f && rm ${DOWNLOAD_TMP_FILE}

fi

echo "mamba path: $(which mamba)"

if ! mamba env list | grep -q pyml; then

    mamba create --yes -n pyml \
        'python==3.10.11' \
        'notebook' 'jupyterhub' 'jupyterlab' \
        'scipy' 'numpy' 'pandas' \
        'altair' 'bokeh' 'matplotlib' 'plotly' 'seaborn'

    # mamba install --yes
    # 'beautifulsoup4' \
    # 'bottleneck' \
    # 'cloudpickle' \
    # 'dask' \
    # 'dill' \
    # 'h5py' \
    # 'ipympl' \
    # 'ipywidgets' \
    # 'jupyterlab-git' \
    # 'matplotlib-base' \
    # 'numba' \
    # 'numexpr' \
    # 'openpyxl' \
    # 'patsy' \
    # 'protobuf' \
    # 'pytables' \
    # 'scikit-image' \
    # 'scikit-learn' \
    # 'sqlalchemy' \
    # 'statsmodels' \
    # 'sympy' \
    # 'widgetsnbextension' \
    # 'xlrd'
fi
