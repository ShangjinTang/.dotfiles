#!/usr/bin/env bash

# mkdir ~/.dotfiles.local &> /dev/null
# pushd ~/.dotfiles.local

# install nnn plugin if nnn exists
if command -v nnn &> /dev/null; then
    if [ ! -d "${XDG_CONFIG_HOME:-$HOME/.config}/nnn/plugins" ] || [ -z "$(ls ${XDG_CONFIG_HOME:-$HOME/.config}/nnn/plugins)" ]; then
        echo "installing nnn plugins"
        bash -c "$(curl -Ls https://raw.githubusercontent.com/jarun/nnn/master/plugins/getplugs)"
    fi
fi

# install fzf if ~/.fzf/install exists
if ! command -v fzf &> /dev/null; then
    if [ -f ~/.fzf/install ]; then
        ~/.fzf/install --all
    fi
fi

# create symlinks from ~/.dotfiles.local/ to ~/
if [ -d ~/.dotfiles.local ]; then
    for file in $(find ~/.dotfiles.local -type f); do
        ln -sf $file "$(echo "$file" | sed 's/\.dotfiles\.local\///')"
    done
fi

if grep -qEi "(Microsoft|WSL)" /proc/version &> /dev/null; then
    rm -rf /mnt/c/.dotfiles &> /dev/null
    if [ ! -f /mnt/c/.dotfiles ]; then
        cp -rL ~/.dotfiles/windows /mnt/c/.dotfiles
    fi
fi
